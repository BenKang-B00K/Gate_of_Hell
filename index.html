<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate of Hell : 악령들의 귀환</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/ui.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/slots.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/units.css">
    <link rel="stylesheet" href="css/enemies.css">
    <link rel="stylesheet" href="css/effects.css">
</head>
<body>
    <!-- Start Screen Overlay -->
        <div id="start-content">
            <h1 class="start-title">Gate of Hell</h1>
            <h2 class="start-subtitle">악령들의 귀환</h2>
            <button id="start-game-btn">퇴마 시작</button>
            <!-- Tutorial Toggle -->
            <div id="tutorial-toggle-container">
                <span id="tutorial-label">도움말</span>
                <label class="switch">
                    <input type="checkbox" id="tutorial-toggle" checked>
                    <span class="slider round"></span>
                </label>
                <span id="tutorial-status">ON</span>
            </div>
        </div>
    </div>

    <div id="game-container">
        <!-- Restart Button -->
        <button id="restart-btn-top">재시작</button>

        <!-- Difficulty Message Overlay -->
        <div id="difficulty-msg-container">
            <div id="difficulty-msg"></div>
        </div>


        <div id="frozen-overlay"></div>
        
        <div id="game-layout">
            <div id="left-slots" class="slot-area"></div>
            <div id="road">
                <div id="spawning-pool"></div>
                <div id="stage-info" style="display:none;"></div> <!-- Legacy hidden -->
                <div id="portal">
                    <!-- Gauge moved to bottom-panel -->
                </div>
            </div>
            <div id="right-slots" class="slot-area"></div>
        </div>

        <div id="start-timer"></div>

        <div id="bottom-panel">
            <!-- Thematic Stage Header (Centralized) -->
            <div id="stage-title-central">
                <span id="stage-name">속삭이는 문</span> [Depth: <span id="stage-display">1</span>]
            </div>

            <!-- Unified Gauges Container (5:30:30:30:5) -->
            <div id="gauges-grid">
                <div class="spacer"></div>
                
                <!-- Soul Energy -->
                <div class="gauge-wrapper" id="se-label" style="cursor:help;">
                    <div class="gauge-info">
                        <span>✨ 소울 에너지 (SE)</span>
                    </div>
                    <div class="gauge-bar se">
                        <div id="se-gauge-fill"></div>
                        <span id="se-display-text" class="gauge-count">150</span>
                    </div>
                </div>

                <!-- Portal Energy -->
                <div class="gauge-wrapper" id="pe-label">
                    <div class="gauge-info">
                        <span>👿 포탈 오염도 (PE)</span>
                    </div>
                    <div class="gauge-bar pe">
                        <div id="portal-gauge-fill"></div>
                        <span id="portal-energy-label" class="gauge-count">0 / 1500</span>
                    </div>
                    <div id="cursed-status">저주: 없음</div>
                </div>

                <!-- Remaining Specters Gauge -->
                <div class="gauge-wrapper rs" id="rs-label">
                    <div class="gauge-info">
                        <span>💀 남은 악령 (RS)</span>
                    </div>
                    <div class="gauge-bar rs">
                        <div id="rs-gauge-fill"></div>
                        <span id="enemies-left" class="gauge-count">0</span>
                    </div>
                </div>

                <div class="spacer"></div>
            </div>

            <div id="bottom-main-ui">
                <div id="control-panel">
                    <!-- 1. Summon Card -->
                    <div id="tower-card" class="tower-card">
                        <div id="summon-warning" class="card-warning" style="display: none;">SE 부족</div>
                        <div style="font-size: 42px;">🪄</div>
                        <div style="font-size: 24px; font-weight: bold;">소환</div>
                        <div id="summon-cost-display" style="font-size: 24px; opacity: 0.8; margin-top: 6px;">40 SE</div>
                    </div>
                    <!-- 2. TBD Card (Formerly Records) -->
                    <div class="tower-card placeholder">
                        <div style="font-size: 30px; color: #444;">준비중</div>
                    </div>
                    <!-- 3. Purge Card -->
                    <div id="purge-card" class="tower-card" style="border-color: #9400d3; color: #9400d3;" title="포탈 오염도 50% 제거">
                        <div id="purge-warning" class="card-warning" style="display: none;">SE 부족</div>
                        <div style="font-size: 42px;">🧹</div>
                        <div style="font-size: 24px; font-weight: bold;">정화</div>
                        <div id="purge-cost-display" style="font-size: 24px; opacity: 0.8; margin-top: 6px;">800 SE</div>
                    </div>
                    <!-- 4. Relics Card -->
                    <div id="relics-btn" class="tower-card" style="border-color: #ff4500; color: #ff4500;">
                        <div style="font-size: 42px;">🏺</div>
                        <div style="font-size: 24px;">유물</div>
                    </div>
                    <!-- 5. TBD Card -->
                    <div class="tower-card placeholder">
                        <div style="font-size: 30px; color: #444;">준비중</div>
                    </div>
                    <!-- 6. Collections Card -->
                    <div id="collections-btn" class="tower-card" style="border-color: #ffd700; color: #ffd700;">
                        <div style="font-size: 42px;">📖</div>
                        <div style="font-size: 24px;">도감</div>
                    </div>
                </div>

                <div id="unit-info">
                    <div class="info-default-text">Gate of Hell<br><span style="font-size:30px; opacity:0.8;">악령들의 귀환</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Collections (도감) Overlay -->
    <div id="collections-overlay" style="display: none;">
        <div id="collections-content">
            <div id="collections-header">
                <div id="collections-tabs">
                    <button class="col-tab-btn active" data-tab="ghosts">유령 도감</button>
                    <button class="col-tab-btn" data-tab="exorcists">퇴마사 도감</button>
                </div>
                <button id="close-collections">X</button>
            </div>
            
            <div id="ghosts-section" class="collections-section active">
                <div class="col-category-nav">
                    <button class="col-cat-btn active" data-cat="normal">일반 유령</button>
                    <button class="col-cat-btn" data-cat="enhanced">악마</button>
                    <button class="col-cat-btn" data-cat="armoured">상위 악마</button>
                    <button class="col-cat-btn" data-cat="boss">마신</button>
                </div>
                <div id="ghost-grid" class="collections-grid">
                    <!-- 10 columns grid dynamically populated -->
                </div>
            </div>

            <div id="exorcists-section" class="collections-section">
                <div id="exorcist-tree-container">
                    <!-- Tree view dynamically populated -->
                </div>
            </div>

            <div id="collection-details">
                <div class="info-default-text">항목을 선택하여 상세 정보를 확인하세요.</div>
            </div>
        </div>
    </div>

    <!-- Corruption Confirmation Overlay -->
    <!-- Spooky Game Over Overlay -->
    <div id="game-over-overlay" style="display: none;">
        <div id="game-over-content">
            <h1 id="game-over-title">영혼이 잠식되었습니다</h1>
            <p id="game-over-msg">심연이 또 다른 영혼을 거두어갔습니다... 문은 무너졌고, 영원한 어둠이 기다립니다.</p>
            <div id="final-stats">도달한 Depth: <span id="final-stage">1</span></div>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="retry-btn">다시 일어나 정화하기 (재도전)</button>
                <button id="cancel-restart-btn" style="display: none;">남아서 저항하기</button>
            </div>
        </div>
    </div>


    <!-- Sacrifice/Corruption Confirmation Modal -->
    <div id="sacrifice-modal" style="display: none;">
        <div id="sacrifice-content">
            <div id="sacrifice-header">⚠️ [절대 금기: 영혼의 파기]</div>
            <div id="sacrifice-body">
                수호자와의 성스러운 계약을 강제로 끊으려 합니까?<br><br>
                영혼을 심연으로 돌려보내는 대가는 결코 가볍지 않으며,<br>
                한번 흩어진 본질은 결코 다시 불러올 수 없습니다.<br><br>
                <strong>정말로 이 수호자를 영원한 어둠 속으로 추방하시겠습니까?</strong>
            </div>
            <div id="sacrifice-footer">
                <button id="sacrifice-confirm-btn">의식 거행 (추방)</button>
                <button id="sacrifice-cancel-btn">계약 유지 (취소)</button>
            </div>
        </div>
    </div>

    <!-- Relics Collection Overlay -->
    <div id="relics-overlay" style="display: none;">
        <div id="relics-content">
            <div id="relics-header">
                <h2>심연의 유물</h2>
                <button id="close-relics">X</button>
            </div>
            <div id="relics-grid">
                <!-- Relics will be dynamically populated here -->
            </div>
            <div id="relic-details">
                <div class="info-default-text">유물을 선택하여 능력을 확인하세요.</div>
            </div>
        </div>
    </div>

    <!-- New Class Unlock Modal / Boss Warning Modal -->
    <div id="unlock-modal" style="display: none;">
        <div id="unlock-content">
            <div id="unlock-header">🆕 새로운 클래스 해금!</div>
            <div id="unlock-icon"></div>
            <div id="unlock-name"></div>
            <div id="unlock-desc"></div>
            <div id="unlock-resume-hint">(아무 곳이나 클릭하여 재개)</div>
        </div>
    </div>

    <div id="max-units-warning" style="display: none;">
        <div class="warning-main">???: 더 이상 퇴마사를 부를 수 없다!</div>
        <div class="warning-sub">(최대 퇴마사 인원: 16)</div>
    </div>

    <!-- Core Game Scripts -->
    <script src="js/allies_data.js"></script>
    <script src="js/allies.js"></script>
    <script src="js/enemies_data.js"></script>
    <script src="js/graphics_units.js"></script>
    <script src="js/graphics_vfx.js"></script>
    <script src="js/graphics_env.js"></script>
    <script src="js/graphics.js"></script>
    <script src="js/enemies.js"></script>
    <script src="js/allies_system.js"></script>
    <script src="js/allies_ui.js"></script>

    <script src="js/attackeffect.js"></script>
    <script src="js/soundeffect.js"></script>
    <script src="js/relics.js"></script>
    <script src="js/collections.js"></script>
    <script src="js/script.js"></script>
</body>
</html>