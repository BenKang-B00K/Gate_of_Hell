<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate of Hell : 악령들의 귀환</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/ui.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/slots.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/units.css">
    <link rel="stylesheet" href="css/enemies.css">
    <link rel="stylesheet" href="css/effects.css">
</head>
<body>
    <!-- Start Screen Overlay -->
    <div id="start-screen">
        <div id="start-content">
            <h1 class="start-title">Gate of Hell</h1>
            <h2 class="start-subtitle">악령들의 귀환</h2>
            <button id="start-game-btn">퇴마 시작</button>
            <!-- Tutorial Toggle -->
            <div id="tutorial-toggle-container">
                <span id="tutorial-label">TUTORIAL</span>
                <label class="switch">
                    <input type="checkbox" id="tutorial-toggle" checked>
                    <span class="slider round"></span>
                </label>
                <span id="tutorial-status">ON</span>
            </div>
        </div>
    </div>

    <div id="game-container">
        <!-- 1. Top Panel: Pure Game World (Canvas) -->
        <div id="top-panel">
            <div id="frozen-overlay"></div>
            <div id="start-timer"></div>
            <!-- Canvas will be injected here by graphics.js -->
        </div>

        <!-- 2. Bottom Panel: Consolidated UI & HUD -->
        <div id="bottom-panel">
            <!-- HUD Area (Top of Bottom Panel) -->
            <div id="hud-top-bar">
                <button id="restart-btn-top">재시작</button>
                
                <!-- Thematic Stage Header -->
                <div id="stage-title-central">
                    <span id="stage-name">속삭이는 문</span>
                    <div class="stage-depth">[Depth: <span id="stage-display">1</span>]</div>
                </div>

                <div id="top-right-hud">
                    <div id="game-tutorial-toggle-container">
                        <span id="game-tutorial-label">TUTORIAL</span>
                        <label class="switch">
                            <input type="checkbox" id="game-tutorial-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                        <span id="game-tutorial-status">ON</span>
                    </div>
                    <button id="game-pause-btn">PAUSE</button>
                </div>
            </div>

            <!-- Gauges Section -->
            <div id="gauges-grid">
                <div class="spacer"></div>
                <!-- Soul Energy -->
                <div class="gauge-wrapper" id="se-label" style="cursor:help;">
                    <div class="gauge-info"><span>✨ SE</span></div>
                    <div class="gauge-bar se">
                        <div id="se-gauge-fill"></div>
                        <span id="se-display-text" class="gauge-count">150 / 1000</span>
                    </div>
                </div>
                <!-- Portal Energy -->
                <div class="gauge-wrapper" id="pe-label">
                    <div class="gauge-info"><span>👿 PE</span></div>
                    <div class="gauge-bar pe">
                        <div id="portal-gauge-fill"></div>
                        <span id="portal-energy-label" class="gauge-count">0 / 1500</span>
                    </div>
                    <div id="cursed-status">저주: 없음</div>
                </div>
                <!-- Remaining Specters -->
                <div class="gauge-wrapper rs" id="rs-label">
                    <div class="gauge-info"><span>💀 RS</span></div>
                    <div class="gauge-bar rs">
                        <div id="rs-gauge-fill"></div>
                        <span id="enemies-left" class="gauge-count">0</span>
                    </div>
                </div>
                <div class="spacer"></div>
            </div>

            <div id="bottom-main-ui">
                <div id="control-panel">
                    <div class="panel-corner tl">🌙</div><div class="panel-corner tr">🌙</div>
                    <div class="panel-corner bl">🌙</div><div class="panel-corner br">🌙</div>

                    <div id="tower-card" class="tower-card">
                        <div id="summon-warning" class="card-warning" style="display: none;">SE 부족</div>
                        <div class="card-icon">🧙</div>
                        <div class="card-label">소환</div>
                        <div id="summon-cost-display" class="card-cost">40 SE</div>
                    </div>
                    <div id="shrine-card" class="tower-card" style="border-color: #00e5ff; color: #00e5ff;">
                        <div id="shrine-warning" class="card-warning" style="display: none;">SE 부족</div>
                        <div class="card-icon">🕍</div>
                        <div class="card-label">성소</div>
                        <div id="shrine-cost-display" class="card-cost">100 SE</div>
                    </div>
                    <div id="purge-card" class="tower-card" style="border-color: #9400d3; color: #9400d3;">
                        <div id="purge-warning" class="card-warning" style="display: none;">SE 부족</div>
                        <div class="card-icon">🔥</div>
                        <div class="card-label">정화</div>
                        <div id="purge-cost-display" class="card-cost">800 SE</div>
                    </div>
                    <div id="relics-btn" class="tower-card" style="border-color: #ff4500; color: #ff4500;">
                        <div class="card-icon">🏺</div><div class="card-label">유물</div>
                    </div>
                    <div id="equip-btn" class="tower-card" style="border-color: #00e5ff; color: #00e5ff;">
                        <div class="card-icon">⚔️</div><div class="card-label">장비</div>
                    </div>
                    <div id="collections-btn" class="tower-card" style="border-color: #ffd700; color: #ffd700;">
                        <div class="card-icon">📖</div><div class="card-label">도감</div>
                    </div>
                </div>

                <div id="unit-info">
                    <div class="info-default-text">Gate of Hell<br><span style="font-size:24px; opacity:0.8;">Sacred Tablet</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Collections (도감) Overlay -->
    <div id="collections-overlay" style="display: none;">
        <div id="collections-content">
            <div id="collections-header">
                <div id="collections-tabs">
                    <button class="col-tab-btn active" data-tab="ghosts">악의 존재</button>
                    <button class="col-tab-btn" data-tab="shrines">성소</button>
                    <button class="col-tab-btn" data-tab="exorcists">퇴마사</button>
                </div>
                <button id="close-collections">❌</button>
            </div>
            <div id="ghosts-section" class="collections-section active">
                <div class="col-category-nav">
                    <button class="col-cat-btn active" data-cat="specter">망령</button>
                    <button class="col-cat-btn" data-cat="wraith">악령</button>
                    <button class="col-cat-btn" data-cat="spirit">원혼</button>
                    <button class="col-cat-btn" data-cat="demon">악마</button>
                    <button class="col-cat-btn" data-cat="abyssal_boss">심연의 지배자</button>
                    <button class="col-cat-btn" data-cat="treasure">특이점</button>
                </div>
                <div id="ghost-grid" class="collections-grid">
                    <!-- 10 columns grid dynamically populated -->
                </div>
            </div>

            <div id="shrines-section" class="collections-section">
                <div id="shrine-grid" class="collections-grid">
                    <!-- Shrine items populated here -->
                </div>
            </div>

            <div id="exorcists-section" class="collections-section">
                <div id="exorcist-tree-container">
                    <!-- Tree view dynamically populated -->
                </div>
            </div>

            <div id="collection-details">
                <div id="col-info-pane">
                    <div class="info-default-text">Gate of Hell<br>도감</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Corruption Confirmation Overlay -->
    <!-- Spooky Game Over Overlay -->
    <div id="game-over-overlay" style="display: none;">
        <div id="game-over-content">
            <h1 id="game-over-title">영혼이 잠식되었습니다</h1>
            <p id="game-over-msg">심연이 또 다른 영혼을 거두어갔습니다... 문은 무너졌고, 영원한 어둠이 기다립니다.</p>
            <div id="final-stats">도달한 Depth: <span id="final-stage">1</span></div>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="retry-btn">다시 일어나 정화하기 (재도전)</button>
            </div>
        </div>
    </div>


    <!-- Sacrifice/Corruption Confirmation Modal -->
    <div id="sacrifice-modal" style="display: none;">
        <div id="sacrifice-content">
            <div id="sacrifice-header">⚠️ [절대 금기: 영혼의 파기]</div>
            <div id="sacrifice-body">
                수호자와의 성스러운 계약을 강제로 끊으려 합니까?<br><br>
                영혼을 심연으로 돌려보내는 대가는 결코 가볍지 않으며,<br>
                한번 흩어진 본질은 결코 다시 불러올 수 없습니다.<br><br>
                <strong>정말로 이 수호자를 영원한 어둠 속으로 추방하시겠습니까?</strong>
            </div>
            <div id="sacrifice-footer">
                <button id="sacrifice-confirm-btn">의식 거행 (추방)</button>
                <button id="sacrifice-cancel-btn">계약 유지 (취소)</button>
            </div>
        </div>
    </div>

    <!-- Relics Collection Overlay -->
    <div id="relics-overlay" style="display: none;">
        <div id="relics-content">
            <div id="relics-header">
                <h2>심연의 유물</h2>
                <button id="close-relics">❌</button>
            </div>
            <div id="relics-grid">
                <!-- Relics will be dynamically populated here -->
            </div>
            <div id="relic-details">
                <div id="relic-info-pane">
                    <div class="info-default-text">Gate of Hell<br>유물 정보</div>
                </div>
                <div id="relic-bonus-pane">
                    <div class="relic-bonus-title">총 유물 보너스</div>
                    <!-- Total bonuses populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- New Class Unlock Modal / Boss Warning Modal -->
    <div id="unlock-modal" style="display: none;">
        <div id="unlock-content">
            <div id="unlock-header">🆕 새로운 클래스 해금!</div>
            <div id="unlock-icon"></div>
            <div id="unlock-name"></div>
            <div id="unlock-desc"></div>
            <div id="unlock-resume-hint">(아무 곳이나 클릭하여 재개)</div>
        </div>
    </div>

    <div id="max-units-warning" style="display: none;">
        <div class="warning-main">???: 더 이상 퇴마사를 부를 수 없다!</div>
        <div class="warning-sub">(최대 퇴마사 인원: 16)</div>
    </div>

    <!-- Equipment (장비) Overlay -->
    <div id="equip-overlay" style="display: none;">
        <div id="equip-content">
            <div id="equip-header">
                <h2>신성한 장비고</h2>
                <button id="close-equip">❌</button>
            </div>
            <div id="equip-grid">
                <!-- 8 Equipment Slots will be here -->
            </div>
            <div id="equip-details">
                <div id="equip-info-pane">
                    <div class="info-default-text">Gate of Hell<br>장비 정보</div>
                </div>
                <div id="equip-bonus-pane">
                    <div class="equip-bonus-title">총 장비 효과</div>
                    <!-- Total equipment bonuses populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Pause Overlay -->
    <div id="pause-overlay" style="display: none;">
        <div id="pause-content">
            <div id="pause-header">⏳ TIME FROZEN</div>
            <div id="pause-body">
                심연의 흐름이 잠시 멈추었습니다.<br>
                준비가 되면 다시 퇴마를 시작하십시오.
            </div>
            <div id="pause-footer">
                <button id="pause-resume-btn">퇴마 재개 (Resume)</button>
            </div>
        </div>
    </div>

    <!-- Quit/Stop Exorcism Confirmation Modal -->
    <div id="quit-modal" style="display: none;">
        <div id="quit-content">
            <div id="quit-header">💀 [운명의 거부]</div>
            <div id="quit-body">
                이미 수많은 영혼이 이 길 위에서 길을 잃었습니다.<br><br>
                당신마저 퇴마를 포기한다면, 이 세상에 남은 빛은 완전히 사라질 것입니다.<br>
                <strong>지금까지의 모든 정화 기록이 소멸되며, 다시는 되돌릴 수 없습니다.</strong><br><br>
                정말로 이 성스러운 임무를 포기하시겠습니까?
            </div>
            <div id="quit-footer">
                <button id="quit-confirm-btn">심연으로 도망 (중단)</button>
                <button id="quit-cancel-btn">운명에 저항 (계속)</button>
            </div>
        </div>
    </div>

    <!-- Core Game Scripts -->
    <script src="js/data_loader.js"></script>
    <script src="js/allies_data.js"></script>
    <script src="js/allies.js"></script>
    <script src="js/enemies_data.js"></script>
    <script src="js/graphics_units.js"></script>
    <script src="js/graphics_vfx.js"></script>
    <script src="js/graphics_env.js"></script>
    <script src="js/graphics.js"></script>
    <script src="js/enemies.js"></script>
    <script src="js/allies_system.js"></script>
    <script src="js/input_handler.js"></script>
    <script src="js/allies_ui.js"></script>

    <script src="js/attackeffect.js"></script>
    <script src="js/soundeffect.js"></script>
    <script src="js/relics.js"></script>
    <script src="js/collections.js"></script>
    <script src="js/equipment.js"></script>
    <script src="js/logger.js"></script>
    <script src="js/script.js"></script>
</body>
</html>